.\" Automatically generated by Pod::Man 4.11 (Pod::Simple 3.35)
.\"
.\" Standard preamble:
.\" ========================================================================
.de Sp \" Vertical space (when we can't use .PP)
.if t .sp .5v
.if n .sp
..
.de Vb \" Begin verbatim text
.ft CW
.nf
.ne \\$1
..
.de Ve \" End verbatim text
.ft R
.fi
..
.\" Set up some character translations and predefined strings.  \*(-- will
.\" give an unbreakable dash, \*(PI will give pi, \*(L" will give a left
.\" double quote, and \*(R" will give a right double quote.  \*(C+ will
.\" give a nicer C++.  Capital omega is used to do unbreakable dashes and
.\" therefore won't be available.  \*(C` and \*(C' expand to `' in nroff,
.\" nothing in troff, for use with C<>.
.tr \(*W-
.ds C+ C\v'-.1v'\h'-1p'\s-2+\h'-1p'+\s0\v'.1v'\h'-1p'
.ie n \{\
.    ds -- \(*W-
.    ds PI pi
.    if (\n(.H=4u)&(1m=24u) .ds -- \(*W\h'-12u'\(*W\h'-12u'-\" diablo 10 pitch
.    if (\n(.H=4u)&(1m=20u) .ds -- \(*W\h'-12u'\(*W\h'-8u'-\"  diablo 12 pitch
.    ds L" ""
.    ds R" ""
.    ds C` ""
.    ds C' ""
'br\}
.el\{\
.    ds -- \|\(em\|
.    ds PI \(*p
.    ds L" ``
.    ds R" ''
.    ds C`
.    ds C'
'br\}
.\"
.\" Escape single quotes in literal strings from groff's Unicode transform.
.ie \n(.g .ds Aq \(aq
.el       .ds Aq '
.\"
.\" If the F register is >0, we'll generate index entries on stderr for
.\" titles (.TH), headers (.SH), subsections (.SS), items (.Ip), and index
.\" entries marked with X<> in POD.  Of course, you'll have to process the
.\" output yourself in some meaningful fashion.
.\"
.\" Avoid warning from groff about undefined register 'F'.
.de IX
..
.nr rF 0
.if \n(.g .if rF .nr rF 1
.if (\n(rF:(\n(.g==0)) \{\
.    if \nF \{\
.        de IX
.        tm Index:\\$1\t\\n%\t"\\$2"
..
.        if !\nF==2 \{\
.            nr % 0
.            nr F 2
.        \}
.    \}
.\}
.rr rF
.\"
.\" Accent mark definitions (@(#)ms.acc 1.5 88/02/08 SMI; from UCB 4.2).
.\" Fear.  Run.  Save yourself.  No user-serviceable parts.
.    \" fudge factors for nroff and troff
.if n \{\
.    ds #H 0
.    ds #V .8m
.    ds #F .3m
.    ds #[ \f1
.    ds #] \fP
.\}
.if t \{\
.    ds #H ((1u-(\\\\n(.fu%2u))*.13m)
.    ds #V .6m
.    ds #F 0
.    ds #[ \&
.    ds #] \&
.\}
.    \" simple accents for nroff and troff
.if n \{\
.    ds ' \&
.    ds ` \&
.    ds ^ \&
.    ds , \&
.    ds ~ ~
.    ds /
.\}
.if t \{\
.    ds ' \\k:\h'-(\\n(.wu*8/10-\*(#H)'\'\h"|\\n:u"
.    ds ` \\k:\h'-(\\n(.wu*8/10-\*(#H)'\`\h'|\\n:u'
.    ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'^\h'|\\n:u'
.    ds , \\k:\h'-(\\n(.wu*8/10)',\h'|\\n:u'
.    ds ~ \\k:\h'-(\\n(.wu-\*(#H-.1m)'~\h'|\\n:u'
.    ds / \\k:\h'-(\\n(.wu*8/10-\*(#H)'\z\(sl\h'|\\n:u'
.\}
.    \" troff and (daisy-wheel) nroff accents
.ds : \\k:\h'-(\\n(.wu*8/10-\*(#H+.1m+\*(#F)'\v'-\*(#V'\z.\h'.2m+\*(#F'.\h'|\\n:u'\v'\*(#V'
.ds 8 \h'\*(#H'\(*b\h'-\*(#H'
.ds o \\k:\h'-(\\n(.wu+\w'\(de'u-\*(#H)/2u'\v'-.3n'\*(#[\z\(de\v'.3n'\h'|\\n:u'\*(#]
.ds d- \h'\*(#H'\(pd\h'-\w'~'u'\v'-.25m'\f2\(hy\fP\v'.25m'\h'-\*(#H'
.ds D- D\\k:\h'-\w'D'u'\v'-.11m'\z\(hy\v'.11m'\h'|\\n:u'
.ds th \*(#[\v'.3m'\s+1I\s-1\v'-.3m'\h'-(\w'I'u*2/3)'\s-1o\s+1\*(#]
.ds Th \*(#[\s+2I\s-2\h'-\w'I'u*3/5'\v'-.3m'o\v'.3m'\*(#]
.ds ae a\h'-(\w'a'u*4/10)'e
.ds Ae A\h'-(\w'A'u*4/10)'E
.    \" corrections for vroff
.if v .ds ~ \\k:\h'-(\\n(.wu*9/10-\*(#H)'\s-2\u~\d\s+2\h'|\\n:u'
.if v .ds ^ \\k:\h'-(\\n(.wu*10/11-\*(#H)'\v'-.4m'^\v'.4m'\h'|\\n:u'
.    \" for low resolution devices (crt and lpr)
.if \n(.H>23 .if \n(.V>19 \
\{\
.    ds : e
.    ds 8 ss
.    ds o a
.    ds d- d\h'-1'\(ga
.    ds D- D\h'-1'\(hy
.    ds th \o'bp'
.    ds Th \o'LP'
.    ds ae ae
.    ds Ae AE
.\}
.rm #[ #] #H #V #F C
.\" ========================================================================
.\"
.IX Title "MOKU-PONA 1"
.TH MOKU-PONA 1 "2020-11-19" "perl v5.30.0" "User Contributed Perl Documentation"
.\" For nroff, turn off justification.  Always turn off hyphenation; it makes
.\" way too many mistakes in technical documents.
.if n .ad l
.nh
.SH "Moku Pona"
.IX Header "Moku Pona"
Moku Pona a Gemini based feed reader. It can monitor URLs to feeds or regular
pages for changes and keeps and updated list of these in a Gemini list. Moku
Pona knows how to fetch Gopher URLs, Gemini URLs, and regular web URLs.
.PP
You manage your subscriptions using the command-line, with Moku Pona.
.PP
You serve the resulting file using a Gemini server.
.PP
You read it all using your Gemini client.
.SS "Limitations"
.IX Subsection "Limitations"
Moku Pona only detects changes. Thus, if there is an item that points to a phlog
or blog, that's great. Sometimes people put their phlog in a folder per year. If
the Gopher menu lists each folder and a date with the latest change, then that's
great, you can use it. Without it, you're in trouble: you need to subscribe to
the item for the current year in order to see changes, but when the next year
comes around, you're subscribed to the wrong item. Sometimes you're lucky and
there will be a menu somewhere with a timestamp for the last change. Use that
instead. Good luck!
.SS "Dependencies"
.IX Subsection "Dependencies"
There are some Perl dependencies you need to satisfy in order to run this
program:
.ie n .IP "Modern::Perl, or ""libmodern\-perl\-perl""" 4
.el .IP "Modern::Perl, or \f(CWlibmodern\-perl\-perl\fR" 4
.IX Item "Modern::Perl, or libmodern-perl-perl"
.PD 0
.ie n .IP "IO::Socket::SSL, or ""libio\-socket\-ssl\-perl""" 4
.el .IP "IO::Socket::SSL, or \f(CWlibio\-socket\-ssl\-perl\fR" 4
.IX Item "IO::Socket::SSL, or libio-socket-ssl-perl"
.ie n .IP "Mojo::UserAgent, or ""libmojolicious\-perl""" 4
.el .IP "Mojo::UserAgent, or \f(CWlibmojolicious\-perl\fR" 4
.IX Item "Mojo::UserAgent, or libmojolicious-perl"
.ie n .IP "XML::LibXML, or ""libxml\-libxml\-perl""" 4
.el .IP "XML::LibXML, or \f(CWlibxml\-libxml\-perl\fR" 4
.IX Item "XML::LibXML, or libxml-libxml-perl"
.ie n .IP "URI::Escape, or ""liburi\-escape\-xs\-perl""" 4
.el .IP "URI::Escape, or \f(CWliburi\-escape\-xs\-perl\fR" 4
.IX Item "URI::Escape, or liburi-escape-xs-perl"
.ie n .IP "\s-1URI\s0, or ""liburi\-perl""" 4
.el .IP "\s-1URI\s0, or \f(CWliburi\-perl\fR" 4
.IX Item "URI, or liburi-perl"
.PD
.SS "The Data Directory"
.IX Subsection "The Data Directory"
Moku Pona keeps the list of URLs you are subscribed to in directory. It's
probably \f(CW\*(C`~/.moku\-pona\*(C'\fR on your system.
.ie n .IP "If you have ""MOKU_PONA"" environment variable set, then that's your data directory." 4
.el .IP "If you have \f(CWMOKU_PONA\fR environment variable set, then that's your data directory." 4
.IX Item "If you have MOKU_PONA environment variable set, then that's your data directory."
.PD 0
.ie n .IP "If you don't, but you have the ""HOME"" environment variable set (this is what usually happens), then your data directory is ""$HOME/.moku\-pona""." 4
.el .IP "If you don't, but you have the \f(CWHOME\fR environment variable set (this is what usually happens), then your data directory is \f(CW$HOME/.moku\-pona\fR." 4
.IX Item "If you don't, but you have the HOME environment variable set (this is what usually happens), then your data directory is $HOME/.moku-pona."
.ie n .IP "The last option is to have the ""LOGDIR"" environment variable set." 4
.el .IP "The last option is to have the \f(CWLOGDIR\fR environment variable set." 4
.IX Item "The last option is to have the LOGDIR environment variable set."
.PD
.PP
The data directory contains a copy of the latest resources. The names of these
cache files are simply the \s-1URL\s0 with all the slashes replaced by a hyphen.
.PP
The \f(CW\*(C`sites.txt\*(C'\fR file is a file containing a gemtext list of links, i.e. entries
such as these:
.PP
.Vb 1
\&    => gemini://alexschroeder.ch Alex Schroeder
.Ve
.PP
The \f(CW\*(C`updates.txt\*(C'\fR file is a file containing a gemtext list of links based on
\&\f(CW\*(C`sites.txt\*(C'\fR, but with a timestamp of their last change, and with new updates
moved to the top. The \s-1ISO\s0 date is simply inserted after the \s-1URL:\s0
.PP
.Vb 1
\&    => gemini://alexschroeder.ch 2020\-11\-07 Alex Schroeder
.Ve
.PP
In order to be at least somewhat backwards compatible with Moku Pona versions
1.1 and earlier, \f(CW\*(C`sites.txt\*(C'\fR may contain Gopher menu items. These are converted
to Gemini URLs during processing and thus the \f(CW\*(C`updates.txt\*(C'\fR file still contains
regular gemtext.
.PP
.Vb 1
\&    1Alex Schroeder X X alexschroeder.ch X 70
.Ve
.PP
As was said above, however, the recommended format is the use of URLs. Moku Pona
supports Gemini, Gopher, and the web (gemini, gopher, gophers, http, and https
schemes).
.SS "Migration from 1.1"
.IX Subsection "Migration from 1.1"
The best way to migrate your setup is probably to use the \f(CW\*(C`list\*(C'\fR subcommand
explained later, and to recreate your list of subscriptions. Then your
\&\f(CW\*(C`sites.txt\*(C'\fR file will use gemtext format.
.PP
.Vb 3
\&    moku\-pona list > commands
\&    mv ~/.moku\-pona/sites.txt ~/.moku\-pona/sites.txt~
\&    sh commands
.Ve
.SS "List your subscriptions"
.IX Subsection "List your subscriptions"
.SS "Add a subscription"
.IX Subsection "Add a subscription"
.Vb 1
\&    moku\-pona add url [description]
.Ve
.PP
This adds a \s-1URL\s0 to the list of subscribed items. If the target is an Atom or \s-1RSS\s0
feed, then that's also supported. You can provide an optional description for
this \s-1URL.\s0 If you don't provide a description, the \s-1URL\s0 will be used as the item's
description.
.PP
Example:
.PP
.Vb 1
\&    moku\-pona add gemini://alexschroeder.ch kensanata
.Ve
.SS "Remove a subscription"
.IX Subsection "Remove a subscription"
.Vb 1
\&    moku\-pona remove description
.Ve
.PP
This removes one or more URLs from the list of subscribed items.
.PP
Example:
.PP
.Vb 1
\&    moku\-pona remove kensanata
.Ve
.SS "Clean up the data directory"
.IX Subsection "Clean up the data directory"
.Vb 1
\&    moku\-pona cleanup [\-\-confirm]
.Ve
.PP
When Moku Pona updates, copies of the \s-1URL\s0 targets are saved in the data
directory. If you remove a subscription (see above), that leaves a cache file in
the data directory that is no longer used X and it leaves an entry in
\&\f(CW\*(C`updates.txt\*(C'\fR that is no longer wanted. The cleanup command fixes this. It
deletes all the cached pages that you are no longer subscribed to, and it
removes those entries from \f(CW\*(C`updates.txt\*(C'\fR as well.
.PP
Actually, just to be sure, if you run it without the \f(CW\*(C`\-\-confirm\*(C'\fR argument, it
simply prints which files it would trash. Rerun it with the \f(CW\*(C`\-\-confirm\*(C'\fR
argument to actually do it.
.PP
Example:
.PP
.Vb 1
\&    moku\-pona cleanup
.Ve
.SS "Update"
.IX Subsection "Update"
.Vb 1
\&    moku\-pona update [\-\-quiet] [names...]
.Ve
.PP
This updates all the subscribed items and generates a new local page for you to
visit: \f(CW\*(C`updates.txt\*(C'\fR.
.PP
Example:
.PP
.Vb 1
\&    moku\-pona update
.Ve
.PP
If you call it from a cron job, you might want to use the \f(CW\*(C`\-\-quiet\*(C'\fR argument to
prevent it from printing all the sites it's contacting (since cron will then
mail this to you and you might not care for it unless there's a problem). If
there's a problem, you'll still get a message.
.PP
This is how I call it from my \f(CW\*(C`crontab\*(C'\fR, for example
.PP
.Vb 2
\&    #m   h  dom mon dow   command
\&    11 7,14 *   *   *     /home/alex/bin/moku\-pona update \-\-quiet
.Ve
.PP
If you're testing things, you can also fetch just a limited number of items by
listing them.
.PP
Example:
.PP
.Vb 1
\&    moku\-pona update "RPG Planet"
.Ve
.PP
The \f(CW\*(C`updates.txt\*(C'\fR files may contain lines that are not links at the top. These
will remain untouched. The rest is links. New items are added at the beginning
of the links and older copies of such items are removed from the links.
.SS "Subscribing to feeds"
.IX Subsection "Subscribing to feeds"
When the result of an update is an \s-1XML\s0 document, then it is parsed and the links
of its items (if \s-1RSS\s0) or entries (if Atom) are extracted and saved in the cache
file in the data directory. The effect is this:
.ie n .IP "If you subscribe to a regular page, then the link to it in ""updates.txt"" moves to the top when it changes." 4
.el .IP "If you subscribe to a regular page, then the link to it in \f(CWupdates.txt\fR moves to the top when it changes." 4
.IX Item "If you subscribe to a regular page, then the link to it in updates.txt moves to the top when it changes."
.PD 0
.ie n .IP "If you subscribe to a feed, then the link in ""updates.txt"" moves to the top when it changes and it links to a file in the data directory that links to the individual items in the feed." 4
.el .IP "If you subscribe to a feed, then the link in \f(CWupdates.txt\fR moves to the top when it changes and it links to a file in the data directory that links to the individual items in the feed." 4
.IX Item "If you subscribe to a feed, then the link in updates.txt moves to the top when it changes and it links to a file in the data directory that links to the individual items in the feed."
.PD
.PP
Example:
.PP
.Vb 2
\&    moku\-pona add https://campaignwiki.org/rpg/feed.xml "RPG"
\&    moku\-pona update
.Ve
.PP
This adds the \s-1RPG\s0 entry to \f(CW\*(C`updates.txt\*(C'\fR as follows:
.PP
.Vb 1
\&    => https%3A\-\-campaignwiki.org\-rpg\-feed.xml 2020\-11\-07 RPG
.Ve
.PP
And if you check the file \f(CW\*(C`https:\-\-campaignwiki.org\-rpg\-feed.xml\*(C'\fR, you'll see
that it's a regular Gemini list. You'll find 100 links like the following:
.PP
.Vb 1
\&    => https://alexschroeder.ch/wiki/2020\-11\-05_Episode_34 Episode 34
.Ve
.PP
Now use \f(CW\*(C`moku\-pona publish\*(C'\fR (see below) to move the files to the correct
directory where your Gemini server expects them.
.SS "Publishing your subscription"
.IX Subsection "Publishing your subscription"
.Vb 1
\&    moku\-pona publish <directory>
.Ve
.PP
This takes the important files from your data directory and copies them to a
target directory. You could just use symbolic links for \f(CW\*(C`sites.txt\*(C'\fR and
\&\f(CW\*(C`updates.txt\*(C'\fR, of course. But if you've subscribed to actual feeds as described
above, then the cache files need to get copied as well!
.PP
Example:
.PP
.Vb 2
\&    mkdir ~/subs
\&    moku\-pona publish ~/subs
.Ve
.SS "Serving your subscriptions via Gemini"
.IX Subsection "Serving your subscriptions via Gemini"
This depends entirely on your Gemini server. If you like it really simple, you
can use Lupa Pona <https://alexschroeder.ch/cgit/lupa-pona/about/>. It comes
with it's own documentation. Here's how to create the certificate and key files,
copy them to the \f(CW\*(C`~/subs\*(C'\fR directory created above, and run \f(CW\*(C`lupa\-pona\*(C'\fR for a
quick test.
.PP
.Vb 4
\&    make cert
\&    cp *.pem ~/subs
\&    cd ~/subs
\&    lupa\-pona
.Ve
